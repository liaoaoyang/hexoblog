title: PHP 使用共享内存
date: 2017-01-04 00:55:40
tags: [PHP]
---

# 概述

[共享内存](https://zh.wikipedia.org/wiki/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98)指在多处理器的计算机系统中，可以被不同中CPU访问的大容量内存。是众多进程间通信（IPC）方式中最快的一种，无需进行数据拷贝等操作，即可在各个进程之间共享数据。

PHP同样也提供了对共享内存操作的可能性，通过`shmop`扩展实现。

# 应用

结合一个实际使用的场景，PHP daemon多进程从上游获取用户ID，需要与指定数据集去重，用户ID大约为12位的数字。

考虑到多进程处理时，需要考虑如何实现便捷，快速的进行判断用户ID已存在于数据集之中。在数据结构上可以使用的几种方法有：

+ Bitmap
+ Hash
+ Array

下面分别说明三者的优缺点：

## Bitmap

Bitmap（位图）的特点在于数据密度大时（即已排序的情况下，相邻数字间隔不大），是极为节省内存用量的数据结构。无论数字多大，在内存中只通过`1 Bit`进行表示。假设用`1 Byte`的空间进行数字的表示，数据集为[1,3,4,5,7]，则这一组数据的位图可以表示为：

```
01011101
```

即便数字相当巨大，在已知最小值的情况下，同样通过同样大小的空间也可表示，如数据集为[100000001,100000003,100000004,100000005,100000007]，同样也可以用同样一个位图进行表示，因为所有数字的都可以认为相对于`100000000`进行了偏移操作。


